<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS310&JS311_Falling Snow</title>
    <!--
1.编写一段JS脚本，在页面上生成自由下落的雪花。要求如下：

    1. 雪花用白色的“*”符号表示即可，无需再使用背景图。要求页面的background为黑色。

    2. 页面上需要有一个下拉框，用户可以通过这个下拉框设置每次生成雪花的数量，数量可以在1-10之间选择。

    3. 点击“生成飘落的雪花”按钮后，将在页面上生成对应数量的雪花（用户可随意多次点击生成雪花按钮，每次都会生成指定数量的雪花）。最开始时雪花的top值为0，left值为一个随机数，然后每隔800毫秒下落10px。下落过程中，每片雪花会左右随机轻微飘动。改变值在0-8px之间。

    4. 点击“删除全部雪花”按钮后，将删除页面上所有的雪花，要求一片不剩。

    5. 雪花飘出屏幕可视窗口范围后，自动消失。
-->
    <script>
        var maxOptNumber = 10;
        var minSnowWidth = 30;
        var maxSnowWidth = 40;
        var windowHeight;
        var windowWidth;

        var minHorizontalMoveDis = -8;
        var maxHorizontalMoveDis = 8;

        var minVerticalMoveDis = 5;
        var maxVerticalMoveDis = 10;

        var clickNum = 0;


        window.onload = function () {
            //add 1-10 selection
            var sel = document.createElement("select");
            sel.id = "sel";
            for (var i = 1; i <= maxOptNumber; i++) {
                var opt = document.createElement("option");
                opt.text = i;

                sel.add(opt);
            }
            document.body.appendChild(sel);

            //add generate button
            var genBtn = document.createElement("input");
            genBtn.type = "button";
            genBtn.value = "Generate Snow";
            document.body.appendChild(genBtn);

            //add remove button
            var rmBtn = document.createElement("input");
            rmBtn.type = "button";
            rmBtn.value = "Remove All Snow";
            document.body.appendChild(rmBtn);

            //add onclick event to button
            genBtn.onclick = generateRandomSnow;
            rmBtn.onclick = removeRandomSnow;

        };

        function getRandomInt(floor, top) {
            return Math.floor(Math.random() * (top - floor + 1)) + floor;
        }

        function generateRandomSnow() {
            clickNum++;

            console.log("---------No." + clickNum + "random generation starts---------------");
            var sel = document.getElementById("sel");
            var val = sel.options[sel.selectedIndex].value;
            console.log(val + " of snow to be generated");


            for (var i = 0; i < val; i++) {


                windowHeight = document.documentElement.clientHeight;
                windowWidth = document.documentElement.clientWidth;

                var randomWidth = getRandomInt(minSnowWidth, maxSnowWidth);
                // console.log("randomWidth:" + randomWidth);

                var randomLeft = getRandomInt(1, windowWidth - randomWidth + 1);
                // console.log("randomLeft:" + randomLeft);


                var snowDiv = document.createElement("div");
                snowDiv.innerHTML = "*";
                snowDiv.style.fontSize = randomWidth + "px";
                snowDiv.style.left = randomLeft + "px";
                snowDiv.style.top = 0 + "px";
                snowDiv.style.position = "absolute";

                document.body.appendChild(snowDiv);


                snowDiv.index = (clickNum - 1) * 10 + i;
                snowDiv.setAttribute("stopFlag", "false");
                console.log("Snow No." + snowDiv.index + " generated done");
                falling(snowDiv);
                /*
                 var num=0;
                 var timer = setInterval(
                 function () {
                     num++;
                     var randomHorizontalMoveDis = getRandomInt(minHorizontalMoveDis, maxHorizontalMoveDis);
                     var randomVerticalMoveDis = getRandomInt(minVerticalMoveDis, maxVerticalMoveDis);
                     console.log(randomHorizontalMoveDis + "," + randomVerticalMoveDis);

                     // console.log(window.getComputedStyle(snowDiv).left+","+window.getComputedStyle(snowDiv).top);
                     snowDiv.style.left = parseInt(window.getComputedStyle(snowDiv).left) + randomHorizontalMoveDis + "px";
                     snowDiv.style.top = parseInt(window.getComputedStyle(snowDiv).top) + randomVerticalMoveDis + "px";
                     console.log(window.getComputedStyle(snowDiv).left + "," + window.getComputedStyle(snowDiv).top);
                     console.log(num);

                     if (num >= 5) {
                         clearInterval(timer);
                     }

                 }

                 , 800);
                 */
            }

            console.log(val + " of snow generated done");
            console.log("");


        }

        function falling(snowDiv) {
            console.log("snowDiv No." + snowDiv.index + " starts falling");
            var timer = setInterval(
                function () {
                    var randomHorizontalMoveDis = getRandomInt(minHorizontalMoveDis, maxHorizontalMoveDis);
                    var randomVerticalMoveDis = getRandomInt(minVerticalMoveDis, maxVerticalMoveDis);
                    // console.log(randomHorizontalMoveDis + "," + randomVerticalMoveDis);

                    // console.log(window.getComputedStyle(snowDiv).left+","+window.getComputedStyle(snowDiv).top);
                    snowDiv.style.left = parseInt(window.getComputedStyle(snowDiv).left) + randomHorizontalMoveDis + "px";
                    snowDiv.style.top = parseInt(window.getComputedStyle(snowDiv).top) + randomVerticalMoveDis + "px";
                    // console.log(window.getComputedStyle(snowDiv).left + "," + window.getComputedStyle(snowDiv).top);

                    console.log("snowDiv No." + snowDiv.index + " keeps falling");//process tracking

                    if (parseInt(window.getComputedStyle(snowDiv).left) > document.documentElement.clientWidth
                        || parseInt(window.getComputedStyle(snowDiv).left) < 0
                        || parseInt(window.getComputedStyle(snowDiv).top) > document.documentElement.clientHeight) {
                        clearInterval(timer);
                        console.log("snowDiv No." + snowDiv.index + " stops falling: Out of Window");
                        console.log("");
                        snowDiv.parentNode.removeChild(snowDiv);//delete the snowDiv in the body

                    } else if (snowDiv.getAttribute("stopFlag") == "true") {
                        clearInterval(timer);
                        console.log("snowDiv No." + snowDiv.index + " stops falling: Removed by RmButton");
                        console.log("");
                        //snowDiv was already removed by RmButton
                    }


                }

                , 800);

        }

        function removeRandomSnow() {
            console.log("RemoveRandomSnow start");
            var snowDivs = document.getElementsByTagName("div");
            for (var i = snowDivs.length - 1; i >= 0; i--) {
                snowDivs[i].setAttribute("stopFlag", "true");//to stop the timer
                snowDivs[i].parentNode.removeChild(snowDivs[i]);
            }
            console.log("RemoveRandomSnow ends");
            console.log("");

        }
    </script>
</head>
<body style="background-color:black;color:white">


</body>
</html>